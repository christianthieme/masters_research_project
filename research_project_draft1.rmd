---
title: 'DATA698 Final Research Project '
author: "Christian Thieme"
date: "12/10/2021"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(VIM)
library(mice)
library(ranger)
library(tidymodels)
library(janitor)
```

## Abstract

This section will be written last after final results are available

## Introduction

Sports analytics has grown exponentially in the last decade. The success of "Moneyball" type analytics in baseball has led to many other sports attempting to find an edge using analytics. Sports teams around the country, both professional and collegiate, employ full-time analysts to try and squeeze out any ounce of improvement for their teams that they can. Another area in the sports arena that has grown tremendously over the last 10 years are fans involvement in "fantasy" leagues. These leagues allow the individual to "draft" players on to their team and then are given points each week based on the performance of the players in the team. The fantasy football following is the largest of all the fantasy sports. While these leagues may sound silly to some, there are millions of people who play and there is **big** money involved. The NFL's biggest prize is \$1,000,000 (Subramanian, 2014).

More and more people are turning from using their gut, to really diving into the analytics of players and teams (Koss, 2020). In a special kind of league called a dynasty league, participants are allowed to keep their players year after year. That means that a major way to improve your standings each year is to draft the right rookies on to your team as players transition from college to the NFL. One of the positions that can have a huge impact on a dynasty team as a rookie is that of the wide receiver.

Each year, dozens of sports analysts make predictions about who the "break out" wide receivers will be based on having watched their college careers. Often the analysts get the obvious players right, but each year there are also surprises and disappointments. Is there a more quantitative way to determine who these breakout players will be?

Answering that question is the purpose of this research project. This project will seek to build a predictive model using a wide receiver's collegiate and NFL combine statistics to accurately predict 80% of the wide receivers that will average 10 fantasy points per game.

## Literature Review

There is little to no academic research in the way of determining break out players in the NFL as it relates to NFL Fantasy leagues. Because having an accurate predictive model in this arena can be extremely lucrative, those who have managed to build such models have done so privately and either charge money to use it, or make money by using it themselves.

While there are articles that discuss what age a player will be when they "break out", they are talked about in an extremely high level fashion without describing any specifics as to the data, the methods, or the model. In fact, most articles won't share more than an r-squared value. Further, when articles do share an r-squared value, it hints that more simple regression type models are being used as opposed to more leading edge, advanced algorithms.

Besides the fact that keeping these models as proprietary property can be "good business", we can also attribute some of the lack of research to the fact that the NFL has historically had the least amount of data available to the public (Lindsey, 2016). The league has only recently found value in tracking and sharing more data, which has led to much of the analytics explosion within the NFL.

## Hypothesis

In this study, I will determine if it is possible to build a predictive model using a wide receiver's collegiate and NFL combine statistics to accurately predict 80% of the wide receivers that will average 10 fantasy points per game.

## Data and Variables

As mentioned previously, there are very few places where you can get extensive historical collegiate data for players who now or did play in the NFL. There are of course popular websites that host basic statistics for each player's collegiate stats, but these statistics are the basic metrics such as yards, touchdowns, etc. Those who are familiar with fantasy football know that each of these metrics can be broken down into many, many more metrics, and combinations of these metrics can lead to hundreds more.

The data source I will use for this project, is perhaps the only one of its kind. It contains hundreds of variables for each player and is maintained by Dave Wright who is a well-known author at DynastyLeagueFootball.com (Wright, n.d.). He provides this dataset free of charge in an effort to help evangelize analytics in fantasy football. It contains player statistics from the 2018-2022 seasons. The dataset also is unique in that it is broken down exclusively into players who are wide receivers. There are 836 rows (players) in the dataset and 602 columns. The dataset contains both numeric and categorical data.

For each player in the dataset, there are several descriptive columns that have critical information for each player and don't contain missing data. These columns are:

-   Player Name

-   School - college they attended

-   Conference - the athletic conference the school is in

-   Date of Birth (DOB)

-   Draft Round - the round the player was selected in the NFL draft (there are 7 rounds)

-   Draft Pick - what number the player was selected overall in the draft

-   Draft Year

-   Draft Age - how old the player was when they were drafter

-   NCAA Seasons - how many seasons they played in the NFL

Following these columns, there are three types of numeric columns: yearly statistics from the 2018-2022 seasons, aggregated metrics from these seasons such as average receptions per game or total career touch downs, and metrics from the NFL combine such as height, weight, 40 time, hand size, etc. In total, there are 100 different metrics. Some of these metrics are straight forward and well known, others are rather specific and are derived from calculations of other columns. A full listing of metrics within the dataset are presented below as well as their definition, the type of metric it is (if it is from a season, a count, from the combine, etc.) and how they are calculated:

| Term                                     | Abbreviations              | Type     | Definition                                                                                                                                                                                                                                                                                                                              | Formula                                                                                                                   |
|------------------------------------------|----------------------------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|
| **20 Yard Shuttle**                      | **Shuttle, Short Shuttle** | Combine  | measures an player's lateral quickness by having the player move laterally 5 yards to touch a line, then 10 yards to the left to touch a line, and finally 5 yards to the right to finish.                                                                                                                                              | \-                                                                                                                        |
| **3 Cone Drill**                         | **3 Cone**                 | Combine  | measures a player's ability to change directions as they run around 3 cones placed in an L-shape.                                                                                                                                                                                                                                       | \-                                                                                                                        |
| **40 Time**                              | **-**                      | Combine  | a sprint measuring 40 yards. Times not recorded at the NFL combine are adjusted by adding .05 seconds to the player time.                                                                                                                                                                                                               | \-                                                                                                                        |
| **Adjusted Yards Per Attempt**           | **AY/A, AYA**              | Metric   | created by Bob Carroll, Pete Palmer, and Jim Thorn in The Hidden Game of Football\* to weight the significance of Pass TDs, Pass Yds, and INT when considering Y/PA. \*source Pro Football Reference.                                                                                                                                   | (Pass YDs + 20\*(Pass TD) - 45\*(INT))/(Pass ATTs)                                                                        |
| **Agility Score**                        | **-**                      | Combine  | a metric intended to measure a player's lateral agility and quickness                                                                                                                                                                                                                                                                   | Shuttle + 3 Cone                                                                                                          |
| **Arm Length**                           | **-**                      | Combine  | the distance from the end of the bicep or shoulder blade to the tip of the middle finger with the arm extended.                                                                                                                                                                                                                         | \-                                                                                                                        |
| **Bench Press**                          | **Bench**                  | Combine  | measures the amount of reps a player can lift 225 lbs in the bench press lifting exercise.                                                                                                                                                                                                                                              | \-                                                                                                                        |
| **Body Mass Index**                      | **BMI**                    | Combine  | an index of an individual's weight compared to their height to describe someone's level of thickness. Derived by Belgian Adolphe Quetelet.                                                                                                                                                                                              | "=((weight in pounds/height in inches)\*703)"                                                                             |
| **Breakout Age**                         | **BOA**                    | Metric   | a metric created by Frank Dupont and Shawn Siegele where a player's production eclipses a certain threshold to represent they have become a significant contributor for their college team                                                                                                                                              | "stat/metric\>threshold"                                                                                                  |
| **Broad Jump**                           | **Broad**                  | Combine  | measures the player's ability to jump horizontally from a balanced stance.                                                                                                                                                                                                                                                              | \-                                                                                                                        |
| **Career Average**                       | **-**                      | \-       | the college career average of a stat or metric for a player.                                                                                                                                                                                                                                                                            | "=AVERAGE(cell for age 18 szn:cell for age 23 szn)"                                                                       |
| **Career Best**                          | **-**                      | \-       | a stat or metric's "best" value in a particular season. For TDs it would be the highest value and for INTs it would be the lowest value.                                                                                                                                                                                                | "=MAX(cell for age 18 szn:cell for age 23 szn)"                                                                           |
| **Career Last**                          | **-**                      | \-       | the value of a stat or metric from the last season of a player's college career.                                                                                                                                                                                                                                                        | "=LOOKUP(9999999999,(cell for age 18 szn:cell for age 23 szn)"                                                            |
| **Career Total**                         | **-**                      | Counting | the total counting stat for a player's college career                                                                                                                                                                                                                                                                                   | \-                                                                                                                        |
| **College Dominator**                    | **CD, DOM**                | Metric   | metric originated by Frank DuPont in his book Game Plan, it represents the player's percentage of their team's offense in respect to the team's yardage and touchdowns.                                                                                                                                                                 | "=(Career Last + Career Best)/2"                                                                                          |
| **Combine Scrimmage Market Share**       | **COMB SCRIM MS**          | Metric   | a metric designed to represent a player's total offensive production within their offense.                                                                                                                                                                                                                                              | ((SCRIM YDs/TM SCRIM Yds)+(SCRIM TDs/TM SCRIM TDs)/2)                                                                     |
| **Combined QB Market Share**             | **COMB QB MS**             | Metric   | a metric designed to represent a QBs production in their team's passing offense.                                                                                                                                                                                                                                                        | ((Pass YDs/TM Pass Yds)/2)+((Pass TDs/TM Pass TDs)/2))                                                                    |
| **Combined QB Team %**                   | **QB COMB TM %**           | Metric   | the percentage of the team yards that were Pass YDs by a player divided by two added to the percentage of the team TDs that were Pass TDs by a player divided by two.                                                                                                                                                                   | ((Pass YDs/TM Yds)/2+(Pass TDs/TM TDs)2)                                                                                  |
| **Combined Receiving Market Share**      | **Comb REC MS**            | Metric   | a metric designed to represent a player's receiving production in their college offense                                                                                                                                                                                                                                                 | ((REC YDs/TM REC Yds)/2)+((REC TDs/TM REC TDs)/2))                                                                        |
| **Combined Rush Market Share**           | **COMB Rush MS**           | Metric   | a metric designed to represent a QBs production in their team's rushing offense.                                                                                                                                                                                                                                                        | ((Rush YDs/TM Rush Yds)/2)+((Rush TDs/TM Rush TDs)/2))                                                                    |
| **Conference**                           | **Conf**                   | Bio      | the college football conference of the team a player played for in their last year of college football. (Non-CFB means non Division 1 schools)                                                                                                                                                                                          | \-                                                                                                                        |
| **Fantasy Points**                       | **PPR Points**             | Metric   |                                                                                                                                                                                                                                                                                                                                         | (REC)+(scrimmage yards\*.1)+(Total TDs\*6)                                                                                |
| **Freak Score**                          | **-**                      | Combine  | an athleticism metric that accounts for the height, weight, and speed of a prospect                                                                                                                                                                                                                                                     | \-                                                                                                                        |
| **Games Played**                         | **GP**                     | Counting | player makes appearance on the field regardless of position.                                                                                                                                                                                                                                                                            | \-                                                                                                                        |
| **Hand Size**                            | **-**                      | Combine  | the distance from the tip of the pinky to the tip of the thumb with the fingers spread out                                                                                                                                                                                                                                              | \-                                                                                                                        |
| **Height**                               | **-**                      | Combine  | the amount of distance from the bottom of a player's heals to the top of their head In inches.                                                                                                                                                                                                                                          | \-                                                                                                                        |
| **Interception %**                       | **INT %**                  | Metric   | Interceptions divided by Pass ATTs                                                                                                                                                                                                                                                                                                      | INT/Pass ATTs                                                                                                             |
| **Kick Return**                          | **Kick Returns**           | Counting | when a player receives a kickoff from the opposing team and attempts to advance the ball down the field.                                                                                                                                                                                                                                | \-                                                                                                                        |
| **Kick Return Touchdown**                | **KR TDs**                 | Counting | when a kick return results in a touchdown for the team that receives it.                                                                                                                                                                                                                                                                | \-                                                                                                                        |
| **Kick Return Yard**                     | **KR YDs**                 | Counting | the yards a player gains after receiving a kickoff from the opposing team                                                                                                                                                                                                                                                               | \-                                                                                                                        |
| **Over Average**                         | **OVR AVG**                | Metric   | a stat or metric over the average of certain cohort of players at that player's position.                                                                                                                                                                                                                                               | \-                                                                                                                        |
| **Over Expected**                        | **OVR EXP**                | Metric   | a stat or metric over the average of that stat or metric for the player's in that conference.                                                                                                                                                                                                                                           | \-                                                                                                                        |
| **Over Team Average**                    | **Over TM AVG**            | Metric   | a stat or metric compared to the player's college team performance for the same stat or metric.                                                                                                                                                                                                                                         | stat/metrcic minus the college team's performance in that stat/metric for the season                                      |
| **Pass Attempt**                         | **Pass ATT, PA**           | Counting | offensive player throws the ball forward when behind line of scrimmage.                                                                                                                                                                                                                                                                 | \-                                                                                                                        |
| **Pass Attempt % of Team Plays**         | **Pass ATT % of TM Plays** | Metric   | the percentage of the team plays that were Pass ATTs by a player.                                                                                                                                                                                                                                                                       | Pass ATT/TM Plays                                                                                                         |
| **Pass College Dominator**               | **Pass CD**                | Metric   | a metric that equally weighs the career last and career best seasons in terms of market share of team yards and touchdowns.                                                                                                                                                                                                             | "=((Career Last QB COMB TM %+Career Best QB COMB TM %)/2)"                                                                |
| **Pass Completion Percentage**           | **Comp %**                 | Metric   | Pass Completions divided by pass attempts                                                                                                                                                                                                                                                                                               | Pass Comp/Pass ATTs                                                                                                       |
| **Pass Interceptions**                   | **INT**                    | Counting | opposing defense catches a pass attempt by the offense.                                                                                                                                                                                                                                                                                 | \-                                                                                                                        |
| **Pass TD %**                            | **Pass TD %**              | Metric   | Pass TDs divided by Pass ATTs                                                                                                                                                                                                                                                                                                           | Pass TDs/Pass ATTs                                                                                                        |
| **Pass TDs % of Team TDs**               | **Pass TDs % of Team TDs** | Metric   | the percentage of the team TDs that were Pass TDs by a player.                                                                                                                                                                                                                                                                          | Pass TDs/TM TDs                                                                                                           |
| **Pass Touchdowns**                      | **Pass TDs**               | Counting | pass thrown behind line of scrimmage that results in a touchdown for the offense.                                                                                                                                                                                                                                                       | \-                                                                                                                        |
| **Pass Yards**                           | **Pass Yds, Pass YDs**     | Counting | yards gained by offense on a completed pass.                                                                                                                                                                                                                                                                                            | \-                                                                                                                        |
| **Pass Yards % of Team Yards**           | **Pass Yds % of TM YDs**   | Metric   | the percentage of the team yards that were Pass YDs by a player.                                                                                                                                                                                                                                                                        | Pass YDs/TM YDs                                                                                                           |
| **NCAA Passing Efficiency**              | **-**                      | Metric   | A passing metric designed to measure QB performance.                                                                                                                                                                                                                                                                                    | ((8.4\*Pass Yds)+(330\*Pass TDs)+(100\*Pass Comp)-(200\*INTs))/Pass ATT                                                   |
| **NFL Passer Rating**                    | **-**                      | Metric   | created by Don Smith, Seymour Siwoff, and Don Weiss to provide a standard for comparing QB passing based on completion % per attempt, yards gained per attempt, % of TD passes per attempt, and % of INTs per attempt.                                                                                                                  | (((Pass Comp/Pass ATTs -.3)\*5+(Pass Yds/Pass ATTs -.3)\*.25+(Pass TDs/Pass ATTs)\*20+2.375-(INT/Pass ATTs\*25))/6)\*100) |
| **Per Carry (Per Rush Attempt)**         | **/Carry or /Rush ATT**    | Metric   | a stat divided by the number of carries/rush attempts in season/career                                                                                                                                                                                                                                                                  | \-                                                                                                                        |
| **Per Game**                             | **/GP**                    | Metric   | stat divided by number of games in season/career.                                                                                                                                                                                                                                                                                       | \-                                                                                                                        |
| **Per Team Pass Attempt**                | **/TM Pass ATT**           | Metric   | stat divided by the player's team pass attempts in a season                                                                                                                                                                                                                                                                             | \-                                                                                                                        |
| **Per Team Pass Touchdown**              | **/TM Pass TD**            | Metric   | stat divided by the player's team pass touchdowns in a season                                                                                                                                                                                                                                                                           | \-                                                                                                                        |
| **Per Play**                             | **/Play**                  | Metric   | stat divided by the player's team plays in a season                                                                                                                                                                                                                                                                                     | \-                                                                                                                        |
| **Per Reception**                        | **/REC**                   | Metric   | stat divided by number of receptions in a season/career                                                                                                                                                                                                                                                                                 | \-                                                                                                                        |
| **Per Team Rush Attempt**                | **/TM Rush ATT**           | Metric   | stat divided by player's team rush attempts in a season.                                                                                                                                                                                                                                                                                | \-                                                                                                                        |
| **Per Team Rush Touchdown**              | **/TM Rush TD**            | Metric   | stat divided by player's team rush touchdowns in a season.                                                                                                                                                                                                                                                                              | \-                                                                                                                        |
| **Per Touch**                            | **/Touch**                 | Metric   | stat divided by number of touches in season/career.                                                                                                                                                                                                                                                                                     | \-                                                                                                                        |
| **Punt Return**                          | **Punt Returns**           | Counting | when a player receives a punt from the opposing team and attempts to advance the ball down the field.                                                                                                                                                                                                                                   | \-                                                                                                                        |
| **Punt Return Touchdown**                | **PR TDs**                 | Counting | when a punt return results in a touchdown for the team that receives it.                                                                                                                                                                                                                                                                | \-                                                                                                                        |
| **Punt Return Yard**                     | **PR YDs**                 | Counting | the yards a player gains after receiving a punt from the opposing team.                                                                                                                                                                                                                                                                 | \-                                                                                                                        |
| **QB Pass Attempt Market Share**         | **QB Pass ATT MS**         | Metric   | the percentage of total team Pass ATTs thrown by a QB                                                                                                                                                                                                                                                                                   | Pass ATT/TM Pass ATT                                                                                                      |
| **QB Pass TD Market Share**              | **QB Pass TD MS**          | Metric   | the percentage of total team Pass TDs thrown by a QB                                                                                                                                                                                                                                                                                    | Pass TDs/TM Pass TDs                                                                                                      |
| **QB Pass Yards Market Share**           | **QB Pass YDs MS**         | Metric   | the percentage of total team Pass YDs thrown by a QB                                                                                                                                                                                                                                                                                    | Pass YDs/TM Pass YDs                                                                                                      |
| **Quarterback Breakout Age**             | **QB BOA**                 | Metric   | Quarterback BOA traditionally is measured as the age a QB first posted a QBR of 50 or higher in college while average 20 action plays per team game. My data for QBR does not go back to 2003 so I came up with a different criteria for QB BOA. QB BOA is when a QB has greater than 50% of their team's passing attempts in a season. | "QB Pass ATT MS\> or =50% and \>100 Pass ATTs"                                                                            |
| **Raw QBR**                              | **-**                      | Metric   | created by ESPN to measure QB efficiency based on the down, distance, yard line at the snap, and the QBs contribution to the result of the play. Then this is divided by the total QB action plays in the game including penalties.                                                                                                     | g(Adjusted EPA/Action Plays)                                                                                              |
| **Receiving College Dominator**          | **REC CD**                 | Metric   | a metric that equally weighs the career last and career best seasons in terms of market share of team receiving yards and receiving touchdowns.                                                                                                                                                                                         | "=((Career Last REC Yards MS+Career Last REC TDs MS+Career Best REC Yards MS+Career Best REC Yards MS)/4)                 |
| **Receiving TD Market Share**            | **REC TD MS**              | Metric   | the percentage of total team receiving TDs by a player.                                                                                                                                                                                                                                                                                 | REC TDs/TM Pass TDs                                                                                                       |
| **Receiving Touchdowns**                 | **REC TDs**                | Counting | a reception that results in a touchdown.                                                                                                                                                                                                                                                                                                | \-                                                                                                                        |
| **Receiving Yards**                      | **REC YDs**                | Counting | the number of yards gained from the line of scrimmage by a player after catching a forward pass.                                                                                                                                                                                                                                        | \-                                                                                                                        |
| **Receiving Yards Market Share**         | **REC YDs MS**             | Metric   | the percentage of total team receiving yards by a player.                                                                                                                                                                                                                                                                               | REC YDs/TM Pass YDs                                                                                                       |
| **Receptions**                           | **REC**                    | Counting | when a player catches and secures possession of a forward pass in bounds.                                                                                                                                                                                                                                                               | \-                                                                                                                        |
| **Receptions Market Share**              | **REC MS**                 | Metric   | the percentage of total team receptions by a player.                                                                                                                                                                                                                                                                                    | REC/TM Completions                                                                                                        |
| **Receptions Per Team Pass ATT**         | **REC/TM Pass ATT**        | Metric   | a receiving efficiency metric that measures the number of receptions per team pass attempt                                                                                                                                                                                                                                              | REC/TM Pass ATT                                                                                                           |
| **Relative Athletic Score**              | **RAS**                    | Metric   | a metric created by Kent Lee Platte that can easily and intuitively gauge a player's athletic abilities relative to the position they play                                                                                                                                                                                              | **-**                                                                                                                     |
| **Return**                               | **-**                      | Counting | when a player receives a kickoff or punt from the opposing team and attempts to advance the ball down the field.                                                                                                                                                                                                                        | KR+PR                                                                                                                     |
| **Return Touchdown**                     | **Return TD**              | Counting | when a kick return or punt return results in a touchdown for the team that receives it.                                                                                                                                                                                                                                                 | KR TDs+PR TDs                                                                                                             |
| **Return Yard**                          | **Return YDs**             | Counting | the yards a player gains after receiving a kickoff or punt from the opposing team                                                                                                                                                                                                                                                       | KR YDs+PR YDs                                                                                                             |
| **Rush Attempt**                         | **Rush ATT**               | Counting | when a player tries to advance the ball up field getting the ball behind the line of scrimmage.                                                                                                                                                                                                                                         | \-                                                                                                                        |
| **Rush Attempt Market Share**            | **Rush ATT MS**            | Metric   | the percentage of total team Rush ATTs by a player.                                                                                                                                                                                                                                                                                     | Rush ATT/TM Rush ATT                                                                                                      |
| **Rush TD Market Share**                 | **Rush TDs MS**            | Metric   | the percentage of total team Rush TDs by a player.                                                                                                                                                                                                                                                                                      | Rush TDs/TM Rush TDs                                                                                                      |
| **Rush Touchdowns**                      | **Rush TDs**               | Counting | a Rush ATT that results in a touchdown                                                                                                                                                                                                                                                                                                  | \-                                                                                                                        |
| **Rush Yards**                           | **Rush YDs**               | Counting | number of yards gained when a player carries the football.                                                                                                                                                                                                                                                                              | \-                                                                                                                        |
| **Rush Yards Market Share**              | **Rush YDs MS**            | Metric   | the percentage of total team Rush YDs by a player.                                                                                                                                                                                                                                                                                      | Rush YDs/TM Rush YDs                                                                                                      |
| **Rushing College Dominator**            | **Rush CD**                | Metric   | a metric that equally weighs the career last and career best seasons in terms of market share of team rushing yards and rushing touchdowns.                                                                                                                                                                                             | "=((Career Last RUSH Yards MS+Career Last RUSH TDs MS+Career Best RUSH Yards MS+Career Best RUSH Yards MS)/4)             |
| **Scrimmage College Dominator**          | **SCRIM CD**               | Metric   | a metric that equally weighs the career last and career best seasons in terms of market share of team scrimmage yards and scrimmage touchdowns.                                                                                                                                                                                         | "=((Career Last SCRIM Yards MS+Career Last SCRIM TDs MS+Career Best SCRIM Yards MS+Career Best SCRIM Yards MS)/4)         |
| **Scrimmage TD Market Share**            | **SCRIM TD MS**            | Metric   | the percentage of total team scrimmage touchdowns by a player.                                                                                                                                                                                                                                                                          | SCRIM TDs/TM SCRIM TDs                                                                                                    |
| **Scrimmage Touchdowns**                 | **SCRIM TDs**              | Counting | the total number of rushing touchdowns and receiving touchdowns by a player                                                                                                                                                                                                                                                             | REC TDs+Rush TDs                                                                                                          |
| **Scrimmage Yards**                      | **SCRIM YDs**              | Counting | the total number of rushing yards and receiving yards by a player                                                                                                                                                                                                                                                                       | REC YDs+Rush YDs                                                                                                          |
| **Scrimmage Yards Market Share**         | **SCRIM YDs MS**           | Metric   | the percentage of total team scrimmage yards by a player.                                                                                                                                                                                                                                                                               | SCRIM YDs/TM SCRIM YDs                                                                                                    |
| **TE Height Adjusted Speed Score**       | **HaSS**                   | Combine  | an athleticism metric developed by Shawn Siegele that creates a metric for tight ends that adjusts a player's 40 time for height.                                                                                                                                                                                                       | (weight\*200)/(40 time\*40 time\*40 time\*40 time)\*(height/76.4)\^2                                                      |
| **Tight End Breakout Age**               | **TE BOA**                 | Metric   | the age in a season a tight end first achieves a greater than 15% receiving dominator rating.                                                                                                                                                                                                                                           | "TE CD\> or =15%"                                                                                                         |
| **Total Adjusted Net Yards Per Attempt** | **TANY/A**                 | Metric   | a schedule-adjusted, rushing-inclusive version of ANY/A or adjusted net yet yards per passing attempt created by Sean Slavin. My version does not adjust for sacks because my college data doesn't have sacks and sack yards.                                                                                                           | (Total Yards+20\* Total TDs-45\*INTs)/Total Attempts                                                                      |
| **Total QB Market Share**                | **Total QB MS**            | Metric   | a metric designed to represent a QBs production based on the percentage the QB had of team Rush YDs, Rush TDs, Pass YDs, and Pass TDs weighed equally.                                                                                                                                                                                  | ((Pass YDs/TM Pass Yds)/2)+((Pass TDs/TM Pass TDs)+(Rush YDs/TM Rush Yds)/2)+((Rush TDs/TM Rush TDs)/4)                   |
| **Total QBR**                            | **-**                      | Metric   | created by ESPN to measure QB efficiency based on the down, distance, yard line at the snap, and the QBs contribution to the result of the play. Then this is divided by the total QB action plays in the game including penalties. This is then adjusted for play difficulty and the quality of opposing defenses.                     | ???                                                                                                                       |
| **Total Touchdowns**                     | **Total TDs**              | Counting | the total amount of rush touchdowns, receiving touchdowns, kick return touchdowns, and punt return touchdowns for a player.                                                                                                                                                                                                             | SCRIM TDs+Return TDs                                                                                                      |
| **Total Touches**                        | **-**                      | Counting | the total amount of rush attempts, receptions, kick returns, and punt returns for a player.                                                                                                                                                                                                                                             | Touches+Returns                                                                                                           |
| **Total Yards**                          | **Total YDs**              | Counting | the total amount of rush yards, receiving yards, kick return yards, and punt return yards for a player.                                                                                                                                                                                                                                 | SCRIM YDs+Return YDs                                                                                                      |
| **Touch Market Share**                   | **Touch MS**               | Metric   | the percentage of total team touches by a player.                                                                                                                                                                                                                                                                                       | Touches/TM Plays                                                                                                          |
| **Touchdown:Interception Ratio**         | **TD:INT Ratio**           | Metric   | Pass TDs divided by Interceptions                                                                                                                                                                                                                                                                                                       | Pass TDs/INT                                                                                                              |
| **Touches**                              | **-**                      | Counting | the total number of receptions and rush attempts by a player                                                                                                                                                                                                                                                                            | REC+Rush ATT                                                                                                              |
| **Vertical Jump**                        | **Vert**                   | Combine  | measures a player's ability to jump off the ground from a flat-footed stance.                                                                                                                                                                                                                                                           | \-                                                                                                                        |
| **Weight**                               | **-**                      | Combine  | the body's relative mass or the quantity of matter contained by it                                                                                                                                                                                                                                                                      | \-                                                                                                                        |
| **Weight Adjusted Speed Score**          | **WaSS**                   | Combine  | an athleticism metric developed by Bill Barnwell in Pro Football Prospectus that adjusts a player's 40 yard dash time for their weight.                                                                                                                                                                                                 | "=(weight\*200)/(40 time\*40 time\*40 time\*40 time)"                                                                     |
| **Wide Receiver Breakout Age**           | **WR BOA**                 | Metric   | the age in a season a wide receiver first achieves a greater than 20% (30% Shawn Siegele) receiving dominator rating.                                                                                                                                                                                                                   | "REC DOM\>20% (30%)"                                                                                                      |
| **WR Height Adjusted Speed Score**       | **HaSS**                   | Combine  | an athleticism metric developed by Shawn Siegele that creates a metric for wide receivers that adjusts a player's 40 time for height.                                                                                                                                                                                                   | (weight\*200)/(40 time\*40 time\*40 time\*40 time)\*(height/73.5)\^2                                                      |

The most difficult part of working with this dataset, is determining what to do with the missing data in each scenario. Almost every row of data has at least one missing value. The reasons for this vary, but common reasons include, the player was injured and missed a season, the player retired and stopped playing during the period of time this dataset contains, the player was drafted and played a season and then didn't play after that or didn't play for several seasons because more seasoned players were ahead of them on the team. For the majority of these cases, the missing values can be filled with 0's because the player truly didn't have a metric.

One area where I decided not to fill missing values with zero was the columns related to the combine tests. Combine results are heavily utilized when players are being drafted and so I am making an assumption that they will be important to the predictive power of our model. It is fairly common for players to miss certain tests within the combine (due to injury, for example), so they may have values for some metrics but not others. A smaller population opt to not take part in the combine, while others may be injured and can't participate.

Because most of the players have values for several of the combine metrics, I assume that players with recorded values in certain metrics may also have similar values in other metrics. For this reason, I am imputing these missing values.

The other struggle was the sheer number of columns within this dataset. Working through 600+ columns is unrealistic, so other methods were needed to determine how to reduce the dimensionality of the dataset.

## Statistical Methods

As dimensionality is an issue with this dataset, two method of dimensionality reduction will be performed to determine the method that produces the most accurate model. First, I'm exploring using lasso regression in order to set some of the less important variable coefficients to zero. Second, the use of PCA will be explored to drastically reduce the size of the dataset.

Our variable of interest will be a variable called "Break Out" that indicates whether a player averages 10 fantasy football points a game or not. The field will be a Yes/No field.

When generating the predictions for this field, it will be useful to also be able to see not only the classification, but the associated probability of that classification so that we can raise or lower the threshold as needed when we tune our model.

Because this is a classification problem, I will test most of the well known algorithms to see which model produces the most accurate results. I will explore:

-   Random Forest

-   K-Nearest Neighbors

-   Support Vector Machines (SVM)

-   XGBOOST

-   Naive Bayes (only if time permits)

Ultimately, the goal of this project is to develop a model that can predict which receivers will average 10 fantasy football points per game with 80% accuracy. That being said, accuracy will be the metric I use for my evaluation criteria. However, in addition to accuracy, I'll also show common classification metrics such as Precision, Sensitivity, and Specificity.

## Discussion of Results

I will compare my model results here in a neat, organized table.

## Conclusion

Summarize results.

## References

Hampton, B. (2020, May 24). *Blake's Predictive 2020 Wide Receiver Model*. Retrieved from The Undroppables: <https://www.theundroppables.com/blakes-predictive-2020-wide-receiver-model/>

Lindsey, J. (2016, January 13). *The NFL Is Finally Tapping Into the Power of Data*. Retrieved from Wired: <https://www.wired.com/2016/01/the-nfls-impending-data-revolution/>

Subramanian, P. (2014, August 29). *The 3 biggest prizes in fantasy football*. Retrieved from Yahoo Finance: <https://www.yahoo.com/entertainment/news/the-3-biggest-prizes-in-fantasy-football-174712081.html>

Wright, D. (n.d.). *DAVID WRIGHT*. Retrieved from <https://dynastyleaguefootball.com/author/spacemnspiff207/:> <https://dynastyleaguefootball.com/author/spacemnspiff207/>

## Appendix

```{r}
wr <- readr::read_csv("https://raw.githubusercontent.com/christianthieme/masters_research_project/master/wide_receiver_databaseV1.csv")  %>% 
  mutate_if(is.character, as.factor)

head(wr)
```

Rookies are those who have been in the NFL for less than 3 years, so we'll exclude these players from the dataset since we won't have enough data for most players to determine if they are "break out" wide receivers.

We'll also remove columns with data from 2023 as there is limited data at this time. We'll also make some other transformations

```{r}
wr2 <- wr %>% 
  filter(Draft_Year < 2019 ) %>%
  select(-contains("_23")) %>% 
  mutate(Drafted = as.factor(ifelse(DR == 'UDFA', 'No', 'Yes'))) %>% 
  mutate(DR = ifelse(DR == 'UDFA', 10, DR)) %>%
  mutate(DP = ifelse(DP == 'UDFA', 999, DP)) %>% 
  mutate(breakout = as.factor(ifelse(fantasy_ppg >= 10, 'Yes', 'No'))) %>% 
##  mutate(Draft_year = as.factor(Draft_Year)) %>% 
  mutate(CareerAverage_KRTDs = as.numeric(CareerAverage_KRTDs)) %>%
  mutate(CareerAverage_PuntReturns = as.numeric(CareerAverage_PuntReturns)) %>%
  mutate(CareerAverage_PRYards = as.numeric(CareerAverage_PRYards)) %>%
  mutate(CareerAverage_PRTDs = as.numeric(CareerAverage_PRTDs))

wr2
```

```{r}
wr2 %>% 
  count(breakout)
```

Removing 2023 statistics removed roughly 51 columns. The dataset contains 656 rows and 551 columns. We have way too many columns. We'll need to use some method to determine which are actually predictive.

There are two challenging problems with this dataset. The first is that there are lots of nulls in the dataset. The second is that there are so many columns in the dataset. We'll have to solve both of these issues in order to come up with an appropriate model.

Most of the nulls can be filled with zeros where the players didn't have any stats for a particular year or metric, however, one of the potentially larger predictive factors are the combine scores, however, quite a few players don't have combine metrics. We'll use a split method here and impute the combine columns, but fill the other metrics with zeros.

-- make conversation about VIM being most accurate imputation method

```{r}

wr_fill_0 <- wr2 %>% 
  select(-Combine_BMI, -Combine_Height, -Combine_Weight, -Combine_HandSize, -Combine_ArmLength, -Combine_40time, -Combine_Bench, -Combine_Vertical, -Combine_Broad, -Combine_Shuttle, -Combine_3Cone, -Combine_HaSS, -RAS, -Agility_Score, -Burst_Score, -Freak_Score) %>%
  mutate(key = paste0(Player, School, Conf, DOB))

wr_fill_0[is.na(wr_fill_0)] <- 0 

# wr_fill_0_key <- wr_fill_0 %>%
#   mutate(key = paste0(Player, School, Conf, DOB)
```

```{r}
wr_fill_impute_select <- wr2 %>% 
  select(Player, School, Conf, DOB, Combine_BMI, Combine_Height, Combine_Weight, Combine_HandSize, Combine_ArmLength, Combine_40time, Combine_Bench, Combine_Vertical, Combine_Broad, Combine_Shuttle, Combine_3Cone, Combine_HaSS, RAS, Agility_Score, Burst_Score, Freak_Score) %>%
  mutate(key = paste0(Player, School, Conf, DOB)) %>% 
  select(-Player, -School, -Conf, -DOB)

wr_no_nulls <- wr_fill_0 %>% 
  left_join(wr_fill_impute_select, by = "key") %>%
  select(-Draft_Year, -key)
```

```{r}
null_cols<- colSums(is.na(wr_no_nulls))
null_cols[null_cols>0]
```

```{r}
null_cols<- colSums(is.na(wr_no_nulls))
null_cols[null_cols>0]
```

In order to fill some of our nulls we'll need to clean up the dataset and get rid of any of the columns that are linear combinations of each other.

```{r}
wr_no_nulls <- wr_no_nulls %>%
  janitor::clean_names()
```

```{r}
wr_no_nulls %>%
  count(breakout) %>%
  mutate(prop = n/sum(n))
```

We will first break out dataset into a train and test split.

```{r}
set.seed(222)
train_test_split <- initial_split(wr_no_nulls, strata = breakout)

wr_train <- training(train_test_split)
wr_test <- testing(train_test_split)
```

Next, we'll utilize cross-validation for our sampling technique:

```{r}
set.seed(345)

folds <- vfold_cv(wr_train, v = 5)
```

```{r}
cores <- parallel::detectCores()
```

```{r}
wr_rf_mod <- rand_forest(mtry = tune(), 
                         min_n = tune(), 
                         trees = 1500) %>%
  set_engine("ranger", num.threads = cores) %>%
  set_mode("classification")
```

```{r}
wr_recipe <- 
  recipe(breakout ~ ., data = wr_train ) %>%
    update_role(player, new_role = "ID") %>%
    step_dummy(all_nominal(), -all_outcomes()) %>%
    step_zv(all_predictors()) %>% #remove all variables with only a single value
    step_normalize(all_predictors()) %>%
    step_knnimpute(all_predictors()) %>%
    step_upsample(breakout, over_ratio = 1.0) 
```

Now its time to build a workflow:

```{r}
wr_wf <- workflow() %>%
  add_model(wr_rf_mod) %>%
  add_recipe(wr_recipe) 

wr_wf_fit <- 
  tune_grid( wr_wf, 
             resamples = folds,
    grid = 25, 
   # split_rule = "gini",
    control = control_grid(save_pred =TRUE), 
    metrics = metric_set(roc_auc)
  )#%>%
  #fit_resamples(folds) 
  
```

```{r}
collect_metrics(wr_wf)
```

```{r}
wr_no_nulls %>% select_if(is.character)
```

```{r}
wr_recipe <- recipe(breakout ~ ., data = wr_train) %>% 
  update_role(Player, new_role = 'ID') %>% 
  step_knnimpute(all_predictors())
```

```{r}
prepped_rec <- prep(wr_recipe, training = wr_train)
train_data <- bake(prepped_rec, new_data = wr_train) %>%
  select(-fantasy_ppg)
test_data <- bake(prepped_rec, new_data = wr_test) %>%
  select(-fantasy_ppg)
```

```{r}
train_data
```

```{r}
set.seed(234)

val_set <- validation_split(train_data, 
                            strata = breakout, 
                            prop = 0.80)

val_set
```

Next, we'll remove unneeded variables

```{r}
cores <- parallel::detectCores()
cores
```

```{r}
rf_mod <- 
  rand_forest(mtry = tune(), 
              min_n = tune(), 
              trees = 1500) %>%
  set_engine("ranger", num.threads = cores) %>%
  set_mode("classification")

rf_mod
```

```{r}
rf_recipe <- 
 recipe(breakout ~ ., data = train_data) %>%
    update_role(Player , new_role = "ID") %>%
    step_novel(all_nominal(), -all_outcomes()) %>%
    step_dummy(all_nominal(), -all_outcomes()) %>%
    step_zv(all_predictors()) %>% #remove all variables with only a single value
    step_normalize(all_predictors()) %>%
    step_knnimpute(all_predictors()) %>%
    step_upsample(breakout, over_ratio = 1.0) 
```

Create a Workflow:

```{r}
rf_workflow <- 
  workflow() %>%
  add_model(rf_mod) %>%
  add_recipe(rf_recipe)
```

Train and Tune the Model

```{r}
rf_res <- 
  rf_workflow %>%
  tune_grid(val_set, 
    grid = 25, 
   # split_rule = "gini",
    control = control_grid(save_pred =TRUE), 
    metrics = metric_set(roc_auc)
  )

rf_res
```

```{r}
rf_res %>% show_best(metric = "roc_auc")
```

```{r}
autoplot(rf_res)
```

```{r}
rf_best <- 
  rf_res %>%
  select_best(metric = "roc_auc")

rf_best
```

```{r}
last_rf_mod <- 
  rand_forest(mtry = 1093, min_n = 9, trees = 1500) %>%
  set_engine("ranger", num.threads = cores, importance = "impurity") %>%
  set_mode("classification")

last_rf_workflow <- 
  rf_workflow %>%
  update_model(last_rf_mod) 

set.seed(345)
last_rf_fit <- 
  last_rf_workflow %>%
  
  last_fit(train_test_split)


last_rf_fit
```

```{r}
last_rf_fit %>%
  collect_metrics()
```
